<!-- import aframe and then ar.js with image tracking / location based features -->
<script src="js/aframe-master.min.js"></script>
<script src="js/aframe-ar-nft.js"></script>
<script src="js/gestures.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<script>
    // 注册markerhandler组件
    // 该组件中注册了，当场景中检测到图像时触发的事件
    AFRAME.registerComponent('markerhandler1', {
        init: function () {
            this.el.sceneEl.addEventListener('markerFound', () => {
                console.log("markerhandler", $(this.el))
                $('#gif-img').attr('src', 'model/p03/show.gif')
                $('.gif-image').css('visibility', 'visible')
            });
            this.el.sceneEl.addEventListener('markerLost', () => {
                console.log("markerLost", $(this.el).data('gif'))
                $('.gif-image').css('visibility', 'hidden')
                $('#gif-img').attr('src', '')
            });
        }
    });
    AFRAME.registerComponent('markerhandler2', {
        init: function () {
            this.el.sceneEl.addEventListener('markerFound', () => {
                console.log("markerhandler2", $(this.el))
                $('#gif-img').attr('src', 'model/p04/show.gif')
                $('.gif-image').css('visibility', 'visible')
            });
            this.el.sceneEl.addEventListener('markerLost', () => {
                console.log("markerLost2", $(this.el).data('gif'))
                $('.gif-image').css('visibility', 'hidden')
                $('#gif-img').attr('src', '')
            });
        }
    });
    AFRAME.registerComponent('markerhandler3', {
        init: function () {
            this.el.sceneEl.addEventListener('markerFound', () => {
                console.log("markerhandler2", $(this.el))
                $('#gif-img').attr('src', 'model/p00/show.gif')
                $('.gif-image').css('visibility', 'visible')
            });
            this.el.sceneEl.addEventListener('markerLost', () => {
                console.log("markerLost2", $(this.el).data('gif'))
                $('.gif-image').css('visibility', 'hidden')
                $('#gif-img').attr('src', '')
            });
        }
    });
    $(document).ready(function () {
        var evt = "onorientationchange" in window ? "orientationchange" : "resize";
        window.addEventListener(evt, resize, false);

        function resize(fals) {
            if (window.orientation == 0 || window.orientation == 180) {
                console.log("豎屏");
                $('.orientation-status').css('visibility', 'visible')
                $('.scan').css('visibility', 'hidden')
            } else {
                console.log("橫屏");
                $('.orientation-status').css('visibility', 'hidden')
                $('.scan').css('visibility', 'visible')
            }
        }
        resize(true);
    });
</script>
<!-- style for the loader -->
<style>
    .arjs-loader {
        height: 100%;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .arjs-loader div {
        text-align: center;
        font-size: 1.25em;
        color: white;
    }

    .gif-image {
        position: absolute;
        width: 360px;
        visibility: hidden;
    }

    .orientation-status {
        position: absolute;
        top: 25%;
        left: 0%;
        width: 100%;
    }

    .bottom-right {
        position: absolute;
        bottom: 5%;
        right: 5%;
        width: 100px;
    }

    .scan {
        width: 50%;
        visibility: hidden;
    }

    .img-container {
        position: absolute;
        top: 25%;
        left: 0%;
        text-align: center;
    }
</style>

<body style="margin : 0px; overflow: hidden;">
    <!-- minimal loader shown until image descriptors are loaded. Loading may take a while according to the device computational power -->
    <div class="arjs-loader">
        <div>正在加载AR模型，请稍候...</div>
    </div>

    <!-- a-frame scene -->
    <a-scene vr-mode-ui="enabled: false;" gesture-detector renderer="logarithmicDepthBuffer: true;" embedded
        arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;">
        <!-- 图片训练后文件路径，不带文件拓展名！ -->
        <a-nft markerhandler1 type="nft" url="model/p03/show" smooth="true" smoothCount="10" smoothTolerance=".01"
            smoothThreshold="5">
        </a-nft>
        <!-- static camera that moves according to the device movemenents -->
        <a-entity id="camera" camera look-controls></a-entity>
    </a-scene>
    <a-scene vr-mode-ui="enabled: false;" gesture-detector renderer="logarithmicDepthBuffer: true;" embedded
        arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;">
        <a-nft markerhandler2 type="nft" url="model/p04/show" smooth="true" smoothCount="10" smoothTolerance=".01"
            smoothThreshold="5">
        </a-nft>
    </a-scene>
    <a-scene vr-mode-ui="enabled: false;" gesture-detector renderer="logarithmicDepthBuffer: true;" embedded
        arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;">
        <a-nft markerhandler3 type="nft" url="model/p00/show" smooth="true" smoothCount="10" smoothTolerance=".01"
            smoothThreshold="5">
        </a-nft>
    </a-scene>
    <img src="assets/images/notice.png" class="orientation-status" />
    <img src="assets/images/bottom-right.png" class="bottom-right" />
    <div class="img-container">
        <img src="" class="gif-image" id="gif-img" />
        <img src="assets/images/scan.png" class="scan" />
    </div>
</body>